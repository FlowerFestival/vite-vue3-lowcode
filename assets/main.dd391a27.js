var e=Object.defineProperty,t=Object.prototype.hasOwnProperty,o=Object.getOwnPropertySymbols,l=Object.prototype.propertyIsEnumerable,a=(t,o,l)=>o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[o]=l,n=(e,n)=>{for(var s in n||(n={}))t.call(n,s)&&a(e,s,n[s]);if(o)for(var s of o(n))l.call(n,s)&&a(e,s,n[s]);return e};import"./index.124f267a.js";import{d as s,r as i,u as r,t as c,o as d,c as u,w as p,a as m,_ as g,b as f,e as v,i as h,p as b,f as y,g as k,h as _,F as C,j as w,k as V,l as D,m as j,n as P,q as O,s as S,v as x,x as U,y as N,z as E,A as I,B as F,C as $,D as B,E as M,G as W,H as z,I as T,J as R,K as L,L as A,M as K,N as q,O as G,P as H,Q as J,R as X,S as Y,T as Q,U as Z,V as ee,W as te,X as oe,Y as le,Z as ae,$ as ne,a0 as se,a1 as ie,a2 as re,a3 as ce,a4 as de,a5 as ue,a6 as pe,a7 as me,a8 as ge,a9 as fe,aa as ve,ab as he,ac as be,ad as ye,ae as ke,af as _e,ag as Ce,ah as we,ai as Ve,aj as De,ak as je,al as Pe,am as Oe,an as Se,ao as xe,ap as Ue,aq as Ne}from"./json.worker.6ee5abbb.js";import{v as Ee,c as Ie,V as Fe,u as $e,a as Be}from"./visual.config.2dbf1e70.js";var Me=s({name:"Preview",props:{visible:{type:Boolean,default:!1}},emits:["update:visible"],setup(e,{emit:t}){const o=i({dialogVisible:r(e,"visible",t),previewUrl:`/vite-vue3-lowcode/preview/${location.hash}`});return n({},c(o))}});Me.render=function(e,t){const o=g;return d(),u(o,{modelValue:e.dialogVisible,"onUpdate:modelValue":t[1]||(t[1]=t=>e.dialogVisible=t),"custom-class":"h5-preview","show-close":!1,width:"360px"},{default:p((()=>[m("iframe",{style:{width:"360px",height:"640px"},src:e.previewUrl,frameborder:"0",scrolling:"auto"},null,8,["src"])])),_:1},8,["modelValue"])};const We=Symbol("injectKey"),ze=()=>h(We);var Te=s({name:"Header",components:{Preview:Me},setup(){const e=i({isShowH5Preview:!1}),{jsonData:t}=ze();return n(n({},c(e)),{runPreview:()=>{sessionStorage.setItem("jsonData",JSON.stringify(t)),localStorage.setItem("jsonData",JSON.stringify(t)),e.isShowH5Preview=!0}})}});const Re=w();b("data-v-7dfa8b7c");const Le=m("div",{class:"logo"},null,-1),Ae=m("h3",{class:"font-semibold"},"H5低代码",-1),Ke=m("div",null,null,-1),qe=m("a",{href:"https://github.com/buqiyuan/vite-vue3-lowcode",target:"_blank"},[m("img",{src:"/vite-vue3-lowcode/github.svg",width:"40",height:"40",alt:""})],-1);y();const Ge=Re(((e,t,o,l,a,n)=>{const s=V,i=D,r=j,c=P,p=k("preview");return d(),u(C,null,[m(c,{type:"flex",class:"header"},{default:Re((()=>[m(s,{span:6,class:"flex items-center"},{default:Re((()=>[Le,Ae])),_:1}),m(s,{span:12},{default:Re((()=>[Ke])),_:1}),m(s,{span:6,class:"right-tools flex flex-row-reverse items-center"},{default:Re((()=>[m(r,{class:"item",effect:"dark",content:"运行",placement:"bottom"},{default:Re((()=>[m(i,{type:"primary",size:"mini",icon:"el-icon-video-play",circle:"",class:"flex-shrink-0",onClick:e.runPreview},null,8,["onClick"])])),_:1}),qe])),_:1})])),_:1}),e.isShowH5Preview?(d(),u(p,{key:0,visible:e.isShowH5Preview,"onUpdate:visible":t[1]||(t[1]=t=>e.isShowH5Preview=t)},null,8,["visible"])):_("",!0)],64)}));Te.render=Ge,Te.__scopeId="data-v-7dfa8b7c";const He=[{name:"pages",icon:"el-icon-tickets",label:"页面",componentName:"PageTree"},{name:"base-widget",icon:"el-icon-edit",label:"基础控件",componentName:"BaseWidgets"},{name:"complex-component",icon:"el-icon-suitcase",label:"容器组件",componentName:"ContainerComponent"},{name:"custom-component",icon:"el-icon-upload",label:"自定义组件",componentName:"custom-component"}];var Je={"list-group-item":"_list-group-item_1kgpy_1",listGroupItem:"_list-group-item_1kgpy_1"},Xe=s({name:"BaseWidgets",setup(){const e=e=>{window.console.log(e)},t=e=>{console.log("当前拖拽的组件：",e);const t=S.cloneDeep(e);return t._vid=Date.now(),Ie({left:0,top:0,component:t})};return()=>m(C,null,[m(O,{class:Je.listGroup,sort:!1,forceFallback:!1,list:Ee.componentModules.baseWidgets,group:{name:"components",pull:"clone",put:!1},clone:t,"item-key":"key",onChange:e},{item:({element:e})=>m("div",{class:Je.listGroupItem,"data-label":e.label},[e.preview()])})])}}),Ye=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:Xe});var Qe={"list-group-item":"_list-group-item_1kgpy_1",listGroupItem:"_list-group-item_1kgpy_1"},Ze=s({name:"ContainerComponent",setup(){const e=e=>{window.console.log(e)},t=e=>{console.log("当前拖拽的组件：",e);const t=S.cloneDeep(e);return t._vid=Date.now(),Ie({left:0,top:0,component:t})};return()=>m(C,null,[m(O,{class:Qe.listGroup,sort:!1,forceFallback:!1,list:Ee.componentModules.containerComponents,group:{name:"components",pull:"clone",put:!1},clone:t,"item-key":"key",onChange:e},{item:({element:e})=>m("div",{class:Qe.listGroupItem,"data-label":e.label},[e.preview()])})])}}),et=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:Ze});const tt={name:"CustomComponent"};tt.render=function(e,t,o,l,a,n){return"自定义组件"};var ot=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:tt}),lt=s({name:"PageTree",setup(){const e=x(),{jsonData:t,setCurrentPage:o,deletePage:l,updatePage:a,incrementPage:s}=ze(),r=i({defaultProps:{children:"children",label:"title"},currentNodeKey:location.hash.slice(1),dialogFormVisible:!1,operatePageData:null,form:{title:"",path:""}}),d=v((()=>Object.keys(t.pages).map((e=>({title:t.pages[e].title,path:e})))));return n(n({},c(r)),{setCurrentPage:o,pages:d,onSubmit:async()=>{const{title:t,path:o}=r.form;r.operatePageData?(a({newPath:o,oldPath:r.operatePageData.path||o,page:{title:t}}),await e.replace(o),r.currentNodeKey=o):s(o,{title:t,blocks:[]}),r.dialogFormVisible=!1},setDefaultPage:e=>{console.log("设置该页面为默认页面",e)},handleNodeClick:t=>{o(t.path),e.push(t.path)},addPage:()=>{r.operatePageData=null,r.form={title:"",path:""},r.dialogFormVisible=!0},editPage:e=>{r.operatePageData=e,r.form={title:e.title,path:e.path},r.dialogFormVisible=!0,console.log("子页面数据：",e)},delPage:e=>{console.log("删除子页面数据",e),l(e.path,"/")}})}});const at=w();b("data-v-66790180");const nt=U("添加页面"),st={class:"custom-tree-node"},it=U("默认"),rt=m("span",{class:"el-dropdown-link"},[m("i",{class:"el-icon-more"})],-1),ct=U("编辑"),dt=U("删除"),ut=U("设为默认"),pt={class:"dialog-footer"},mt=U("取 消"),gt=U("确 定");y();const ft=at(((e,t,o,l,a,n)=>{const s=D,i=I,r=F,c=$,p=B,f=M,v=W,h=z,b=T,y=g;return d(),u(C,null,[m(s,{type:"primary",size:"small",style:{margin:"10px 0"},icon:"el-icon-plus",onClick:e.addPage},{default:at((()=>[nt])),_:1},8,["onClick"]),m(f,{data:e.pages,props:e.defaultProps,"node-key":"path","highlight-current":"","current-node-key":e.currentNodeKey,onNodeClick:e.handleNodeClick},{default:at((({node:o,data:l})=>[m("span",st,[m("span",null,[U(N(o.label)+"（"+N(l.path)+"） ",1),l.isDefault?(d(),u(i,{key:0,size:"mini"},{default:at((()=>[it])),_:1})):_("",!0)]),m("span",{onClick:t[1]||(t[1]=E((()=>{}),["stop"]))},[m(p,{trigger:"click"},{dropdown:at((()=>[m(c,null,{default:at((()=>[m(r,{icon:"el-icon-edit",onClick:t=>e.editPage(l)},{default:at((()=>[ct])),_:2},1032,["onClick"]),m(r,{icon:"el-icon-delete",onClick:t=>e.delPage(l)},{default:at((()=>[dt])),_:2},1032,["onClick"]),m(r,{icon:"el-icon-link",onClick:t=>e.setDefaultPage(l)},{default:at((()=>[ut])),_:2},1032,["onClick"])])),_:2},1024)])),default:at((()=>[rt])),_:2},1024)])])])),_:1},8,["data","props","current-node-key","onNodeClick"]),m(y,{modelValue:e.dialogFormVisible,"onUpdate:modelValue":t[5]||(t[5]=t=>e.dialogFormVisible=t),width:"380px",title:e.operatePageData?"编辑页面":"新增页面"},{footer:at((()=>[m("span",pt,[m(s,{onClick:t[4]||(t[4]=t=>e.dialogFormVisible=!1)},{default:at((()=>[mt])),_:1}),m(s,{type:"primary",onClick:e.onSubmit},{default:at((()=>[gt])),_:1},8,["onClick"])])])),default:at((()=>[m(b,{model:e.form},{default:at((()=>[m(h,{label:"页面标题","label-width":"80px"},{default:at((()=>[m(v,{modelValue:e.form.title,"onUpdate:modelValue":t[2]||(t[2]=t=>e.form.title=t),autocomplete:"off"},null,8,["modelValue"])])),_:1}),m(h,{label:"页面路径","label-width":"80px"},{default:at((()=>[m(v,{modelValue:e.form.path,"onUpdate:modelValue":t[3]||(t[3]=t=>e.form.path=t),autocomplete:"off"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue","title"])],64)}));lt.render=ft,lt.__scopeId="data-v-66790180";const vt={"./base-widgets/index.tsx":Ye,"./container-component/index.tsx":et,"./custom-component/index.vue":ot,"./page-tree/index.vue":Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:lt})},ht={};console.log(vt,"起航");for(const uo in vt){const e=vt[uo].default;ht[e.name]=e}console.log("left-aside components:",ht);var bt=s({name:"LeftAside",components:ht,setup(){const e=i({activeName:He[0].name});return n(n({},c(e)),{tabs:He,handleClick:(e,t)=>{console.log(e,t)}})}});const yt=w();b("data-v-6e5ac0ae");const kt={class:"flex flex-col items-center justify-center"};y();const _t=yt(((e,t,o,l,a,n)=>{const s=K,i=L;return d(),u(i,{modelValue:e.activeName,"onUpdate:modelValue":t[1]||(t[1]=t=>e.activeName=t),"tab-position":"left",onTabClick:e.handleClick},{default:yt((()=>[(d(!0),u(C,null,R(e.tabs,(t=>(d(),u(s,{key:t.name,name:t.name},{label:yt((()=>[m("div",kt,[m("i",{class:t.icon},null,2),U(" "+N(t.label),1)])])),default:yt((()=>[(d(),u(A(t.componentName),e.$attrs,null,16))])),_:2},1032,["name"])))),128))])),_:1},8,["modelValue","onTabClick"])}));bt.render=_t,bt.__scopeId="data-v-6e5ac0ae";var Ct="_drawer_e36ge_9",wt="_is-open_e36ge_26",Vt="_floating-action-btn_e36ge_21",Dt="_attrs_e36ge_53";function jt(e,t){const o=H(e());return J(e,(e=>{e!==o.value&&(o.value=e)})),{get value(){return o.value},set value(e){o.value!==e&&(o.value=e,t(e))}}}s({props:{modelValue:{type:String}},emits:["update:modelValue"],setup(e,t){const o=jt((()=>e.modelValue),(e=>t.emit("update:modelValue",e)));return()=>m("div",null,[U("自定义的输入框"),q(m("input",{type:"text","onUpdate:modelValue":e=>o.value=e},null),[[G,o.value]])])}});const Pt=()=>{const e={};return e.promise=new Promise(((t,o)=>{e.resolve=t,e.reject=o})),e};const Ot=s({props:{option:{type:Object,required:!0}},setup(e){const t=le(),o=i({option:e.option,showFlag:!1,mounted:(()=>{const e=Pt();return X((()=>setTimeout((()=>e.resolve()),0))),e.promise})(),editData:[]}),l={service:e=>{o.option=e,o.editData=S.cloneDeep(e.data||[]),l.show()},show:async()=>{await o.mounted,o.showFlag=!0},hide:()=>{o.showFlag=!1},add:()=>{o.editData.push({})},reset:()=>{o.editData=S.cloneDeep(o.option.data)}},a={onConfirm:()=>{o.option.onConfirm(o.editData),l.hide()},onCancel:()=>{l.hide()},onDelete:e=>{o.editData.splice(e,1)}};return Object.assign(t.proxy,l),()=>m(C,null,[m(Y,{modelValue:o.showFlag},{default:()=>m("div",null,[m("div",null,[m(Q,{onClick:l.add},{default:()=>[U("添加")]}),m(Q,{onClick:l.reset},{default:()=>[U("重置")]})]),m(Z,{data:o.editData},{default:()=>[m(ee,{type:"index"},null),o.option.config.table.options.map((e=>m(ee,{label:e.label},{default:({row:t})=>m(te,{modelValue:t[e.field],"onUpdate:modelValue":o=>t[e.field]=o},null)}))),m(ee,{label:"操作栏"},{default:({$index:e})=>m(Q,oe({type:"danger"},{onClick:()=>a.onDelete(e)}),{default:()=>[U("删除")]})})]})]),footer:()=>m(C,null,[m(Q,{onClick:a.onCancel},{default:()=>[U("取消")]}),m(Q,oe({type:"primary"},{onClick:a.onConfirm}),{default:()=>[U("确定")]})])})])}}),St=(()=>{let e;return t=>{if(!e){const o=document.createElement("div");document.body.appendChild(o);const l=ae(Ot,{option:t});e=l.mount(o)}const o=Pt();return e.service(n(n({},t),{onConfirm:o.resolve})),o.promise}})(),xt=s({props:{modelValue:{type:Array},propConfig:{type:Object,required:!0}},emits:["update:modelValue"],setup(e,t){const o=jt((()=>e.modelValue),(e=>t.emit("update:modelValue",e))),l=async()=>{const t=await St({config:e.propConfig,data:e.modelValue||[]});o.value=t};return()=>m("div",null,[(!o.value||0==o.value.length)&&m(Q,{onClick:l},{default:()=>[U("添加")]}),(o.value||[]).map((t=>m(ne,{onClick:l},{default:()=>[t[e.propConfig.table.showKey]]})))])}});(globalThis||window).MonacoEnvironment={getWorker:(e,t)=>"json"===t?new se:"css"===t||"scss"===t||"less"===t?new ie:void 0},re.getLanguages();var Ut="_container_z26um_9",Nt="_title_z26um_16",Et="_code_z26um_21";let It,Ft=!1;var $t=s({name:"MonacoEditor",props:{code:{type:String,required:!0},vid:[String,Number],onChange:{type:Function,required:!0},title:{type:String,required:!0}},setup(e){const t=ce(null),o=H(null),l=()=>{window.requestIdleCallback((()=>{t.value.getAction("editor.action.formatDocument").run()}),{timeout:800})};X((()=>{t.value=de.create(o.value,{value:e.code,theme:"vs-dark",language:"json",formatOnPaste:!0,tabSize:2,minimap:{enabled:!1},fontFamily:"微软雅黑",overviewRulerBorder:!1,scrollBeyondLastLine:!1}),It=t.value.onDidChangeModelContent((o=>{Ft||e.onChange(t.value.getValue(),o)})),l(),t.value.layout({width:300,height:800})})),ue((()=>{It&&It.dispose()}));return J((()=>e.vid),(()=>{if(t.value){const o=t.value,a=o.getModel();a&&e.code!==a.getValue()&&(o.pushUndoStop(),Ft=!0,a.pushEditOperations([],[{range:a.getFullModelRange(),text:e.code}],(()=>null))),o.pushUndoStop(),Ft=!1,l()}})),()=>m("div",{class:Ut},[e.title&&m("div",{class:Nt},[m("span",null,[e.title])]),m("div",{class:Et,ref:o},null)])}});function Bt(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!be(e)}var Mt=s({name:"RightAttributePanel",props:{block:{type:Object,default:()=>({})}},setup(e,{emit:t}){const{visualConfig:o}=ze(),l=i({activeName:"attr",isOpen:!0,editData:r(e,"block",t)}),a=(e,t)=>{const{propObj:o,prop:a}=$e(l.editData.props,e);return{[Fe.input]:()=>m(te,{modelValue:o[a],"onUpdate:modelValue":e=>o[a]=e},null),[Fe.inputNumber]:()=>m(me,{modelValue:o[a],"onUpdate:modelValue":e=>o[a]=e},null),[Fe.switch]:()=>m(ge,{modelValue:o[a],"onUpdate:modelValue":e=>o[a]=e},null),[Fe.color]:()=>m(fe,{modelValue:o[a],"onUpdate:modelValue":e=>o[a]=e},null),[Fe.select]:()=>{let e;return m(ve,{modelValue:o[a],"onUpdate:modelValue":e=>o[a]=e,valueKey:"value"},Bt(e=t.options.map((e=>m(he,{label:e.label,value:e.val},null))))?e:{default:()=>[e]})},[Fe.table]:()=>m(xt,{modelValue:o[a],"onUpdate:modelValue":e=>o[a]=e,propConfig:t},null)}[t.type]()};return()=>{const t=[];if(e.block){const{componentKey:l}=e.block,n=o.componentMap[l];console.log("props.block:",e.block),t.push(m(pe,{label:"组件ID",labelWidth:"76px"},{default:()=>[e.block._vid,m(ye,{width:200,trigger:"hover",content:`你可以利用该组件ID。对该组件进行获取和设置其属性，组件可用属性可在控制台输入：$$refs.${e.block._vid} 进行查看`},{reference:()=>m("i",{style:{marginLeft:"6px"},class:"el-icon-warning-outline"},null)})]})),n&&n.props&&t.push(m(C,null,[Object.entries(n.props||{}).map((([e,t])=>m(pe,{key:e},{default:()=>[a(e,t)],label:()=>t.tips?m(C,null,[m(ye,{width:200,trigger:"hover",content:t.tips},{reference:()=>m("i",{class:"el-icon-warning-outline"},null)}),t.label]):t.label})))]))}else t.push(m(C,null,[m(pe,{label:"容器宽度"},{default:()=>[m(me,oe({modelValue:l.editData.width,"onUpdate:modelValue":e=>l.editData.width=e},{step:100}),null)]}),m(pe,{label:"容器高度"},{default:()=>[m(me,oe({modelValue:l.editData.height,"onUpdate:modelValue":e=>l.editData.height=e},{step:100}),null)]})]));const n=e=>{try{const t=JSON.parse(e);Object.assign(l.editData,t)}catch(t){console.log("JSON格式有误：",t)}};return m(C,null,[m("div",{class:[Ct,{[wt]:l.isOpen}]},[m("div",{class:Vt,onClick:()=>l.isOpen=!l.isOpen},[m("i",{class:"el-icon-d-arrow-"+(l.isOpen?"right":"left")},null)]),m("div",{class:Dt},[m(ke,{modelValue:l.activeName,"onUpdate:modelValue":e=>l.activeName=e},{default:()=>[m(_e,{label:"属性面板",name:"attr"},{default:()=>[m(Ce,{size:"mini","label-position":"left"},Bt(t)?t:{default:()=>[t]})]}),m(_e,{label:"JSON",name:"json",lazy:!0},{default:()=>[m($t,{code:JSON.stringify(e.block),vid:"json"==l.activeName?e.block._vid:-1,onChange:n,title:""},null)]})]})])])])}}}),Wt=s({name:"DraggableTransitionGroup",components:{draggable:O},props:{moduleValue:{type:Array,default:()=>[]},drag:{type:Boolean,default:!1}},emits:["update:moduleValue","update:drag"],setup(e,{emit:t}){const o=i({list:r(e,"moduleValue",t),isDrag:r(e,"drag",t)}),l=v((()=>({animation:200,group:"components",disabled:!1,ghostClass:"ghost"})));return n(n({},c(o)),{log:()=>{},dragOptions:l})}});const zt=w(),Tt=zt(((e,t,o,l,a,n)=>{const s=k("draggable");return d(),u(s,oe({modelValue:e.list,"onUpdate:modelValue":t[1]||(t[1]=t=>e.list=t),class:["dragArea list-group",{isDrag:e.isDrag}],tag:"transition-group",group:{name:"nested-draggable"},"component-data":{tag:"div",type:"transition-group",name:e.isDrag?null:"flip-list"},"item-key":"_vid"},e.dragOptions,{onStart:t[2]||(t[2]=t=>e.isDrag=!0),onEnd:t[3]||(t[3]=t=>e.isDrag=!1),onChange:e.log}),{item:zt((t=>[m("div",null,[we(e.$slots,"item",t,void 0,!0)])])),_:1},16,["modelValue","class","component-data","onChange"])}));Wt.render=Tt,Wt.__scopeId="data-v-225673ea";const Rt=(()=>{const e="@@DROPDOWN_SERVICE_PROVIDER";return{provide:t=>Ve(e,t),inject:()=>h(e)}})(),Lt=s({props:{option:{type:Object,required:!0}},setup(e){const t=le(),o=H({}),l=i({option:e.option,showFlag:!1,top:0,left:0,mounted:(()=>{const e=Pt();return X((()=>setTimeout((()=>e.resolve()),0))),e.promise})()}),a={show:async()=>{await l.mounted,l.showFlag=!0},hide:()=>{l.showFlag=!1}},n=v((()=>["dropdown-service",{"dropdown-service-show":l.showFlag}])),s=v((()=>({top:`${l.top}px`,left:`${l.left}px`})));Object.assign(t.proxy,{service:e=>{if(l.option=e,"addEventListener"in e.reference){const{top:t,left:o,height:a}=e.reference.getBoundingClientRect();l.top=t+a,l.left=o}else{const{clientX:t,clientY:o}=e.reference;l.left=t,l.top=o}a.show()}});const r=e=>{o.value.contains(e.target)||a.hide()};return X((()=>document.body.addEventListener("mousedown",r,!0))),ue((()=>document.body.removeEventListener("mousedown",r,!0))),Rt.provide({onClick:a.hide}),()=>m("div",{class:n.value,style:s.value,ref:o},[l.option.content()])}}),At=s({props:{label:{type:String},icon:{type:String}},emits:["click"],setup(e,t){const{onClick:o}=Rt.inject(),l={onClick:e=>{t.emit("click",e),o()}};return()=>m("div",{class:"dropdown-option",onClick:l.onClick},[m("i",{class:e.icon},null),m("span",null,[e.label])])}}),Kt=(()=>{let e;return t=>{if(!e){const o=document.createElement("div");document.body.appendChild(o);const l=ae(Lt,{option:t});e=l.mount(o)}e.service(t)}})();var qt=s({name:"CompRender",props:{element:{type:Object,default:()=>({})},config:{type:Object,default:()=>({})}},setup:e=>()=>e.config.componentMap[e.element.componentKey].render({size:{},props:e.element.props||{},model:{},block:e.element,custom:{}})}),Gt=s({name:"SlotItem",components:{CompRender:qt,DraggableTransitionGroup:Wt},props:{slotKey:String,config:{type:Object,default:()=>({})},children:{type:Array,default:()=>[]},selectComp:{type:Function},onContextmenuBlock:{type:Function}},emits:["update:children","on-selected"],setup:(e,{emit:t})=>({drag:H(!1),slotChildren:r(e,"children",t)})});const Ht=w(),Jt=Ht(((e,t,o,l,a,n)=>{var s;const i=k("SlotItem",!0),r=k("comp-render"),c=k("draggable-transition-group");return d(),u(c,{modelValue:e.slotChildren,"onUpdate:modelValue":t[1]||(t[1]=t=>e.slotChildren=t),drag:e.drag,"onUpdate:drag":t[2]||(t[2]=t=>e.drag=t),class:["inner-draggable",{slot:!(null==(s=e.slotChildren)?void 0:s.length)}],"data-slot":`插槽（${e.slotKey}）\n 拖拽组件到此处`},{item:Ht((({element:t})=>{var o,l;return[m("div",{class:["list-group-item inner",{focus:t.focus,focusWithChild:t.focusWithChild}],"data-label":t.label,onContextmenu:E((o=>e.onContextmenuBlock(o,t,e.slotChildren)),["stop","prevent"]),onMousedown:E((o=>e.selectComp(t)),["stop"])},[m(r,{config:e.config,element:t,style:{pointerEvents:Object.keys((null==(o=t.props)?void 0:o.slots)||{}).length?"auto":"none"}},De({_:2},[R(null==(l=t.props)?void 0:l.slots,((t,o)=>({name:o,fn:Ht((()=>[m(i,{children:t.children,"onUpdate:children":e=>t.children=e,"slot-key":o,config:e.config,"on-contextmenu-block":e.onContextmenuBlock,"select-comp":e.selectComp},null,8,["children","onUpdate:children","slot-key","config","on-contextmenu-block","select-comp"])]))})))]),1032,["config","element","style"])],42,["data-label","onContextmenu","onMousedown"])]})),_:1},8,["modelValue","drag","class","data-slot"])}));Gt.render=Jt,Gt.__scopeId="data-v-a3397532";var Xt=s({name:"SimulatorEditor",components:{DraggableTransitionGroup:Wt,CompRender:qt,SlotItem:Gt},emits:["on-selected"],setup(e,{emit:t}){const{globalProperties:o}=Be(),{currentPage:l,visualConfig:a}=ze(),s=i({compRefs:[],drag:!1}),r=(e,t=[],o=[])=>{var l,a;for(let n=0;n<t.length;n++){const s=o.concat();if(s.push(t[n]),e==t[n]._vid)return s;const i=(null==(l=t[n].props)?void 0:l.slots)||{},c=Object.keys(i);for(let t=0;t<c.length;t++){const o=null==(a=i[c[t]])?void 0:a.children;if(o){const t=r(e,o,s);if(t)return t}}}},d=(e,t)=>{var o;const a=(null==(o=e.props)?void 0:o.slots)||{};Object.keys(a).length>0&&Object.keys(a).forEach((e=>{var o,n;null==(n=null==(o=a[e])?void 0:o.children)||n.forEach((e=>{var o;if(e.focusWithChild=!1,e.focus=e._vid==t,e.focus){r(t,l.value.blocks).forEach((e=>e.focusWithChild=!0))}Object.keys((null==(o=e.props)?void 0:o.slots)||{}).length&&d(e,t)}))}))};return n(n({},c(s)),{currentPage:l,visualConfig:a,selectComp:e=>{t("on-selected",e),l.value.blocks.forEach((t=>{t.focus=e._vid==t._vid,t.focusWithChild=!1,d(t,e._vid),e.focusWithChild=!1}))},onContextmenuBlock:(e,t,a=l.value.blocks)=>{Kt({reference:e,content:()=>m(C,null,[m(At,oe({label:"复制节点",icon:"el-icon-document-copy"},{onClick:()=>{const e=a.findIndex((e=>e._vid==t._vid));if(-1!=e){const t=(e,o=-1)=>{var l;e._vid=`vid_${Date.now()+o}`;const a=(null==(l=null==e?void 0:e.props)?void 0:l.slots)||{},n=Object.keys(a);n.length&&n.forEach((e=>{var o,l;null==(l=null==(o=a[e])?void 0:o.children)||l.forEach(((e,o)=>t(e,o)))}))},o=S.cloneDeep(a[e]);t(o),a.splice(e,0,o)}}}),null),m(At,oe({label:"删除节点",icon:"el-icon-delete"},{onClick:()=>{const e=a.findIndex((e=>e._vid==t._vid));-1!=e&&(delete o.$$refs[a[e]._vid],a.splice(e,1))}}),null)])})}})}});const Yt=w(),Qt=Yt(((e,t)=>{const o=k("slot-item"),l=k("comp-render"),a=k("draggable-transition-group");return d(),u(a,{drag:e.drag,"onUpdate:drag":t[1]||(t[1]=t=>e.drag=t),modelValue:e.currentPage.blocks,"onUpdate:modelValue":t[2]||(t[2]=t=>e.currentPage.blocks=t)},{item:Yt((({element:t})=>{var a,n;return[m("div",{class:["list-group-item",{focus:t.focus,focusWithChild:t.focusWithChild,drag:e.drag,"no-child":!Object.keys(t.props.slots||{}).length}],"data-label":t.label,onContextmenu:E((o=>e.onContextmenuBlock(o,t)),["stop","prevent"]),onMousedown:o=>e.selectComp(t)},[m(l,{config:e.visualConfig,element:t,style:{pointerEvents:Object.keys((null==(a=t.props)?void 0:a.slots)||{}).length?"auto":"none"}},De({_:2},[R(null==(n=t.props)?void 0:n.slots,((t,l)=>({name:l,fn:Yt((()=>[m(o,{children:t.children,"onUpdate:children":e=>t.children=e,"slot-key":l,config:e.visualConfig,"on-contextmenu-block":e.onContextmenuBlock,"select-comp":e.selectComp},null,8,["children","onUpdate:children","slot-key","config","on-contextmenu-block","select-comp"])]))})))]),1032,["config","element","style"])],42,["data-label","onContextmenu","onMousedown"])]})),_:1},8,["drag","modelValue"])}));Xt.render=Qt,Xt.__scopeId="data-v-e513dd64";var Zt=s({name:"Simulator"});const eo=w();b("data-v-39828a84");const to={class:"simulator-container"},oo={class:"simulator-editor"};y();const lo=eo(((e,t)=>(d(),u("div",to,[m("div",oo,[we(e.$slots,"default",{},void 0,!0)])]))));Zt.render=lo,Zt.__scopeId="data-v-39828a84";var ao=s({name:"Layout",components:{Header:Te,LeftAside:bt,RightAttributePanel:Mt,SimulatorEditor:Xt,Simulator:Zt},setup(){const e=i({currentBlock:{}});return n(n({},c(e)),{onSelected:t=>{e.currentBlock=t,console.log("currentBlock:",e.currentBlock)}})}});ao.render=function(e,t,o,l,a,n){const s=k("Header"),i=je,r=k("left-aside"),c=Pe,g=k("simulator-editor"),f=k("simulator"),v=k("right-attribute-panel"),h=Oe,b=Se;return d(),u(b,null,{default:p((()=>[m(i,{height:"80px",class:"flex items-center shadow-md"},{default:p((()=>[m(s)])),_:1}),m(b,{class:"layout-container"},{default:p((()=>[m(c,{class:"shadow-sm",width:"350px"},{default:p((()=>[m(r)])),_:1}),m(h,null,{default:p((()=>[m(f,null,{default:p((()=>[m(g,{onOnSelected:e.onSelected},null,8,["onOnSelected"])])),_:1}),m(v,{block:e.currentBlock,"onUpdate:block":t[1]||(t[1]=t=>e.currentBlock=t)},null,8,["block"])])),_:1})])),_:1})])),_:1})};var no=s({name:"App",components:{VisualEditor:ao},setup(){const e=(()=>{var e;const t=JSON.parse(sessionStorage.getItem("jsonData"))||{container:{width:360,height:960},pages:{"/":{title:"首页",blocks:[]}}};console.log("jsonData：",t);const o=()=>location.hash.slice(1),l=e=>e.startsWith("/")?e:`/${e}`,a=i({jsonData:t,currentPage:null!=(e=t.pages[o()])?e:t.pages["/"]});window.addEventListener("hashchange",(()=>{r(o())}));const s=(e="",t="")=>{delete a.jsonData.pages[e],t&&r(t)},r=(e="/")=>{a.currentPage=t.pages[e]};return{jsonData:f(a.jsonData),currentPage:v((()=>a.currentPage)),visualConfig:Ee,setCurrentPage:r,updatePage:({newPath:e,oldPath:t,page:o})=>{e&&e!=t?(a.jsonData.pages[l(e)]=n(n({},a.jsonData.pages[t]),o),s(t,l(e))):Object.assign(a.jsonData.pages[t],o)},incrementPage:(e="",t={title:"新页面",blocks:[]})=>{a.jsonData.pages[l(e)]=t},deletePage:s,updatePageBlock:(e="",t=[])=>{a.jsonData.pages[e].blocks=t}}})();Ve(We,e);const{jsonData:t}=e;window.addEventListener("beforeunload",(()=>{sessionStorage.setItem("jsonData",JSON.stringify(t))}))}});no.render=function(e,t,o,l,a,n){const s=k("visual-editor");return d(),u(s)};const so=xe({history:Ue(),routes:[]}),io={count:0};var ro=Ne({state:()=>io,mutations:{increment(e){e.count++}},actions:{increment(e){e.commit("increment")}},getters:{double:e=>2*e.count}});const co=ae(no);co.config.globalProperties.$$refs={},window.$$refs=co.config.globalProperties.$$refs,co.use(so).use(ro).mount("#app");
